{"version":3,"file":"Autocomplete.stories-7fab295c.js","sources":["../../../../packages/antwerp-ui/react-components/src/lib/molecules/autocomplete/Autocomplete.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport { TextField } from '../../atoms/input';\nimport { FunctionalList, ListItem } from '../../atoms/list';\nimport { Flyout } from '../flyout';\nimport { AutocompleteProps } from './Autocomplete.types';\nimport './Autocomplete.css';\n\nexport function Autocomplete({\n  id = 'aui-autocomplete',\n  label,\n  items,\n  name,\n  multiple,\n  required,\n  inputValue,\n  value,\n  onInputChange,\n  onChange,\n  noResultsText = 'Geen resultaten',\n  qa,\n  description,\n  state,\n  addOn\n}: AutocompleteProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [results, setResults] = useState(items);\n  const [input, setInput] = useState(inputValue || '');\n  const [selected, setSelected] = useState<string>((!multiple && (value as string)) || '');\n  const [cursor, setCursor] = useState(-1);\n  const [selectedMultiple, setSelectedMultiple] = useState<string[]>((multiple && (value as string[])) || []);\n\n  const fieldValue = inputValue || inputValue === '' ? inputValue : input;\n  const selectedValue = value || value === '' ? value : selected;\n\n  const flyoutRef = React.useRef(null);\n\n  useEffect(() => {\n    if (value && !multiple) {\n      selectValue(value as string, true);\n    }\n    if (value && multiple) {\n      setSelectedMultiple(value as string[]);\n    }\n  }, [value]);\n\n  useEffect(() => {\n    setResults(\n      (items || []).filter((i) => (fieldValue ? i.label?.toLowerCase().includes(fieldValue.toLowerCase()) : true))\n    );\n  }, [fieldValue, items]);\n\n  useEffect(() => {\n    if (flyoutRef.current) {\n      const current = flyoutRef.current as HTMLDivElement;\n      const highlighted = current.querySelector(`.a-list__item:nth-child(${cursor + 1})`);\n      highlighted?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n    }\n  }, [cursor]);\n\n  const handleStateChange = (state: boolean) => {\n    setIsOpen(state);\n  };\n\n  const closeFlyout = () => {\n    setIsOpen(false);\n    setCursor(-1);\n  };\n\n  const handleInput = (val: string) => {\n    setInput(val);\n    setIsOpen(true);\n    if (selectedValue && !val) {\n      setSelected('');\n      !multiple && onChange && onChange('', name);\n    }\n    onInputChange && onInputChange(val, name);\n  };\n\n  const selectValue = (val: string, silence = false) => {\n    if (!multiple && value !== '' && (!value || value === val)) {\n      const actualValue = items?.find((i) => i.value === val);\n      handleInput(actualValue?.label || '');\n      setSelected(actualValue?.value || '');\n      closeFlyout();\n    }\n    !silence && onChange && onChange(val, name);\n  };\n\n  const selectMultiple = (val: string) => {\n    const actualValue = items?.find((i) => i.value === val);\n    actualValue && setSelected(actualValue.value);\n    const newSelectedMultiple = !selectedMultiple.includes(val)\n      ? [...selectedMultiple, val].filter((v) => v !== '')\n      : selectedMultiple.filter((value) => value !== val);\n    setSelectedMultiple(newSelectedMultiple);\n    onChange && onChange(newSelectedMultiple, name);\n  };\n\n  const setValueBack = () => {\n    const actualValue = items?.find((i) => i.value === selectedValue);\n    if (actualValue && fieldValue?.length && actualValue.label !== fieldValue) {\n      handleInput(actualValue.label);\n    }\n    closeFlyout();\n  };\n\n  const onEnter = () => {\n    const highlighted = results && results[cursor];\n    if (highlighted) {\n      multiple ? selectMultiple(highlighted.value) : selectValue(highlighted.value);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const totalResults = results?.length || 0;\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setCursor(cursor === -1 ? 0 : (cursor + 1) % totalResults);\n        return setIsOpen(true);\n      case 'ArrowUp':\n        e.preventDefault();\n        setCursor(cursor === -1 ? totalResults - 1 : cursor - 1 < 0 ? totalResults - 1 : cursor - 1);\n        return setIsOpen(true);\n      case 'Enter':\n        return onEnter();\n      case 'Escape':\n        return closeFlyout();\n      default:\n        break;\n    }\n  };\n\n  const isValueActive = (val: string) => {\n    return multiple ? selectedMultiple.includes(val) : val === selectedValue;\n  };\n\n  return (\n    <Flyout\n      scrollable\n      hasPadding={false}\n      qa={qa}\n      className=\"m-autocomplete\"\n      trigger={\n        <TextField\n          id={id}\n          name={name}\n          label={label}\n          onBlur={setValueBack}\n          value={fieldValue}\n          onChange={(e) => handleInput(e.target.value)}\n          role=\"combobox\"\n          autoComplete=\"off\"\n          aria-autocomplete=\"list\"\n          aria-haspopup=\"true\"\n          aria-expanded={isOpen}\n          onKeyDown={handleKeyDown}\n          description={description}\n          required={required}\n          state={state}\n          addOn={addOn ? { ...addOn, content: addOn.content } : undefined}\n        />\n      }\n      ref={flyoutRef}\n      open={isOpen}\n      onStateChange={handleStateChange}\n    >\n      {results && results.length ? (\n        <FunctionalList\n          lined\n          onItemClick={(v) => {\n            multiple ? selectMultiple(v) : selectValue(v);\n          }}\n        >\n          {results.map((r, i) => (\n            <ListItem\n              id={r.value}\n              tabIndex={-1}\n              highlighted={i === cursor}\n              onMouseDown={(e) => e.preventDefault()}\n              active={isValueActive(r.value)}\n              name={r.value}\n              link={{ href: '' }}\n              key={r.value}\n            >\n              {r.label}\n            </ListItem>\n          ))}\n        </FunctionalList>\n      ) : (\n        <FunctionalList lined>\n          <ListItem id=\"aui-autocomplete-no-results\">\n            <small>{noResultsText}</small>\n          </ListItem>\n        </FunctionalList>\n      )}\n    </Flyout>\n  );\n}\n\nexport default Autocomplete;\n"],"names":["Autocomplete","id","label","items","name","multiple","required","inputValue","value","onInputChange","onChange","noResultsText","qa","description","state","addOn","isOpen","setIsOpen","useState","results","setResults","input","setInput","selected","setSelected","cursor","setCursor","selectedMultiple","setSelectedMultiple","fieldValue","selectedValue","flyoutRef","React","useEffect","selectValue","i","_a","highlighted","handleStateChange","closeFlyout","handleInput","val","silence","actualValue","selectMultiple","newSelectedMultiple","v","setValueBack","onEnter","handleKeyDown","totalResults","isValueActive","jsx","Flyout","TextField","FunctionalList","r","ListItem","e"],"mappings":"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"}